# π§€ μ¤ν”„λ§μ IoCμ™€ μƒμ„±μ μ£Όμ…ν•΄μ•Όν•λ” μ΄μ 

> μ¤ν”„λ§μ IoCμ™€ DI(μμ΅΄ κ΄€κ³„ μ£Όμ… λ°©μ‹)μ— λ€ν•΄ μ•μ•„λ³΄μ•λ‹¤. λν• DI λ°©μ‹ μ¤‘ μƒμ„±μ μ£Όμ…μ„ μ‚¬μ©ν•΄μ•Όν•λ” μ΄μ μ— λ€ν•΄ μ •λ¦¬ν•΄λ³΄μ•λ‹¤.



### μ μ–΄μ μ—­μ „(IoC)μ΄λ€

IoCλ” κ°μ²΄μ μƒμ„±, κ°μ²΄ μƒλ… κ΄€λ¦¬, νλ¦„ μ μ–΄, μμ΅΄ κ΄€κ³„ μ„¤μ •μ„ μ  3μμ—κ² μ„μ„ν•λ” ν”„λ΅κ·Έλλ° λ°©μ‹μ΄λ‹¤. ν”„λ μ„μ›ν¬μ—μ„ μ“°λ” λ°©λ²•μΌλ΅, κ°λ°μλ” ν•„μ”ν• λ¶€λ¶„μ„ κµ¬ν„ν•΄μ„ ν”„λ μ„μ›ν¬μ— λΌμ› λ„£λ” μ‹μΌλ΅ κ°λ°ν•λ‹¤. ν”„λ΅κ·Έλ¨μ€ κ°λ°μμ— μν•΄μ„ μ μ–΄λλ” κ²ƒμ΄ μ•„λ‹λΌ ν”„λ μ„μ›ν¬μ λ‚΄λ¶€μ—μ„ κ²°μ •λ λ€λ΅ μ΄λ¤„μ§€κ² λλ”λ°, μ΄λ¥Ό "**μ μ–΄μ μ—­μ „**"μ΄λΌ ν•λ‹¤.

μ•„λλ” κ°λ°μκ°€ μ§μ ‘ κ°μ²΄λ¥Ό μƒμ„±ν•λ” κ²½μ°μ™€ IoCκ°€ μ μ©λ κ²½μ°μ΄λ‹¤. A κ°μ²΄κ°€ B κ°μ²΄μ— μμ΅΄ν•λ” μƒν™©μ΄λ‹¤.

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p>IoC μ μ© μμ‹</p></figcaption></figure>

1. **κ°λ°μκ°€ μ§μ ‘ κ°μ²΄λ¥Ό μƒμ„±ν•μ—¬ μ½”λ“λ¥Ό μ μ–΄ν•λ” κ²½μ° (IoC X)**

```java
// κµ¬ν„μ²΄μ— μμ΅΄
// Aκ°μ²΄λ” Bκ°μ²΄μ—κ² μμ΅΄ν•λ‹¤
public class A {

    private B b;

    public A()
        b = new B(); // κµ¬ν„μ²΄ λ³€κ²½ μ‹ ν΄λμ¤ λ‚΄λ¶€ μ½”λ“λ¥Ό λ³€κ²½ν•΄μ•Όν•λ‹¤.
	// b = new B`();
    }
}
```

**2. μ»¨ν…μ΄λ„μ— μν•΄ μƒμ„±λ κ°μ²΄λ¥Ό μ£Όμ…λ°›λ” κ²½μ° (IoC O)**

```java
// μΈν„°νμ΄μ¤μ—λ§ μμ΅΄
class A {
    private B b;

    @Autowired // IoC μ»¨ν…μ΄λ„μ—μ„ μ£Όμ…ν•΄μ¤€λ‹¤.
    public A(B b) {
        this.b = b;
    }
}

// ν΄λΌμ΄μ–ΈνΈ μ½”λ“ : DI, μμ΅΄κ΄€κ³„λ¥Ό μ™Έλ¶€μ—μ„ μ£Όμ…
new A(new BImpl1());
new A(new BImpl2());
```

A κ°μ²΄κ°€ B κ°μ²΄μ— μμ΅΄ν•λ” μƒν™©μ—μ„ IoCλ¥Ό μ μ©ν•  κ²½μ°μ™€ κ°λ°μκ°€ μ§μ ‘ μμ΅΄ κ°μ²΄ μƒμ„±ν•  λ•λ¥Ό λΉ„κµν•΄λ³΄μ•λ‹¤.

**1.  κ°λ°μκ°€ μ§μ ‘ κ°μ²΄λ¥Ό μƒμ„±ν•μ—¬ μ½”λ“λ¥Ό μ μ–΄ν•λ” κ²½μ° (IoC X)**

μ°μ„  A κ°μ²΄ λ‚΄λ¶€μ—μ„ B κ°μ²΄λ¥Ό μƒμ„±ν•  κ²½μ°, Aκ°€ B κµ¬ν„μ²΄μ— μμ΅΄ν•λ‹¤κ³  λ³Ό μ μλ‹¤. B κ°μ²΄μ—μ„ B\` κ°μ²΄λ΅ **λ³€κ²½ν•λ ¤λ©΄ A ν΄λμ¤ λ‚΄λ¶€ μ½”λ“κ°€ λ³€κ²½λμ–΄μ•Ό ν•λ‹¤.**

**2.  μ»¨ν…μ΄λ„μ— μν•΄ μƒμ„±λ κ°μ²΄λ¥Ό μ£Όμ…λ°›λ” κ²½μ° (IoC O)**

λ°λ©΄, A κ°μ²΄κ°€ B μΈν„°νμ΄μ¤μ— μμ΅΄ν•  κ²½μ°, Aκ°€ B μ¶”μƒμ²΄μ— μμ΅΄ν•λ‹¤κ³  λ³Ό μ μλ‹¤. μ΄ κ²½μ° μ™Έλ¶€μ—μ„ B κµ¬ν„μ²΄λ¥Ό κ²°μ •ν•΄μ„ μ£Όμ…ν•λ‹¤. **λ”°λΌμ„ BImpl1μ—μ„ BImpl2λ΅ λ³€κ²½λμ–΄λ„ A ν΄λμ¤ λ‚΄λ¶€ μ½”λ“κ°€ λ³€κ²½λμ§€λ” μ•λ”λ‹¤. μ΄λ• μ¤ν”„λ§μ—μ„ @Autowired μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μΌλ©΄, ν•΄λ‹Ήν•λ” κ°μ²΄λ¥Ό μλ™ μ£Όμ…ν•΄μ¤€λ‹¤.**

****

### IoC μ‚¬μ©ν•λ” μ΄μ 

IoCλ¥Ό μ‚¬μ©ν•λ©΄, κ°μ²΄ Aκ°€ μ§μ ‘ B κ°μ²΄λ¥Ό μƒμ„±ν•λ” κ² μ•„λ‹λΌ, μ™Έλ¶€(IoC μ»¨ν…μ΄λ„)μ—μ„ κ°μ²΄λ¥Ό μƒμ„±ν•κ³  κ΄€κ³„ μ„¤μ •ν•΄μ¤€λ‹¤. ν΄λμ¤ λ‚΄λ¶€μ μ‘μ§‘λ„λ” λ†’μ΄κ³  ν΄λμ¤λ“¤ κ°„ κ²°ν•©λ„λ” λ‚®μ¶”μ–΄ λ³€κ²½μ— μ μ—°ν• κµ¬μ΅°λ¥Ό κ°€μ§€κ² λλ‹¤.&#x20;

* κ°μ²΄ Aλ” Bμ κµ¬ν„μ²΄κ°€ μ•„λ‹λΌ μ¶”μƒμ²΄μ— μμ΅΄ν•μ—¬, κΈ°λ¥ ν™•μ¥μ— μ—΄λ ¤μκ³  μ½”λ“ λ³€κ²½μ΄ ν•„μ”μ—†λ‹¤. μ¦‰, OCPλ¥Ό μ§€ν‚¨λ‹¤.&#x20;
* λν• κ°μ²΄ μƒμ„±/κ΄€λ¦¬ν•λ” λ¶€λ¶„κ³Ό κ°λ°μκ°€ κµ¬ν„ν•λ” λ¶€λ¶„μ„ λ‚λλ‹¤. κ°μ²΄ κ΄€λ¦¬λ” μ»¨ν…μ΄λ„μ—κ² λ§΅κΈ°κ³ , κ°λ°μλ” μμ‹ μ΄ κ°λ°ν•λ” λ¶€λ¶„μ—λ§ μ§‘μ¤‘ν•λ‹¤.



#### **Springμ—μ„μ IoC, DI μ‘λ™ λ°©μ‹ -** @Autowired

μ¤ν”„λ§ μ„λ²„κ°€ μ¬λΌκ° λ•

1. μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈ(λΉ ν©ν† λ¦¬, IoC μ»¨ν…μ΄λ„)κ°€ @Bean, @Service, @Controller λ“± μ–΄λ…Έν…μ΄μ…μ„ μ΄μ©ν•μ—¬ λ“±λ΅ν• μ¤ν”„λ§ λΉμ„ μƒμ„±ν•λ‹¤.
2. μƒμ„±μ, μμ •μμ— @Autowired μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μΌλ©΄ ν•΄λ‹Ήν•λ” κ°μ²΄λ¥Ό μ»¨ν…μ΄λ„μ—μ„ μ£Όμ…ν•΄μ¤€λ‹¤.



### **DI μμ΅΄κ΄€κ³„ μ£Όμ…** λ°©μ‹

DI λ°©μ‹μ—λ” μƒμ„±μ μ‚½μ…, μμ •μ μ‚½μ…, ν•„λ“ μ£Όμ…μ΄ μλ‹¤.

#### 1. **ν•„λ“ μ£Όμ… (Field Injection)**

```java
@Service
public class AImpl implements A {

    @Autowired
    private B b;

    @Override
    public void bmethod() {
        b.method();
    }
}
```

#### 2. μμ •μ (**setter) μ£Όμ… (Setter Injection)**

```java
@Service
public class AImpl implements A {

    private B b;

    @Autowired
    public void setB(B b) {
        this.b = b;
    }

    @Override
    public void bmethod() {
        b.method();
    }
}
```

κ·Έλ¬λ‚ μ„μ 2κ°€μ§€ λ°©λ²•μ—μ„λ” κµ¬ν„μ²΄(`BImpl`)κ°€ μ£Όμ…λμ§€ μ•μ•„λ„ `κ°μ²΄ A`κ°€ μƒμ„±λ  μ μλ‹¤. μ΄λ•, κµ¬ν„μ²΄(`BImpl`)μ λ©”μ†λ“λ¥Ό μ‹¤ν–‰ν•λ©΄ `NullPointerException`κ°€ λ°μƒν•λ‹¤.

μ΄ μ½”λ“μ—μ„λ” Bκ°€ μ£Όμ…λμ§€ μ•μ•„λ„ A κ°μ²΄κ°€ μƒμ„±λ  μ μλ‹¤. `bmethod()`μ κ²½μ°, Bλ¥Ό μ°Έμ΅°ν•μ—¬ Bμ λ©”μ†λ“κ°€ μ‹¤ν–‰λλ‹¤. Bκ°€ μ£Όμ…λμ§€ μ•μ•λ”λ° κ°μ²΄ Aμ—μ„ ν•΄λ‹Ή λ©”μ†λ“ μ‹¤ν–‰ μ‹ `NPE`κ°€ λ°μƒν•λ‹¤.

λ”°λΌμ„ Aκ°€ Bμ— μμ΅΄ν•λ” κ²½μ°, **Bκ°€ λ°λ“μ‹ μ£Όμ…λμ–΄μ•Ό A κ°μ²΄κ°€ μƒμ„±λλ” μƒμ„±μ μ£Όμ…**μ„ μ‚¬μ©ν•λ” κ² μ•μ „ν•λ‹¤.

#### 3. **μƒμ„±μ μ£Όμ… (Constructor Injection)**&#x20;

```java
@Service
public class AImpl implements A {

    private final B b;

    @Autowired
    public AImpl(B b) {
        this.b = b;
    }

    @Override
    public void bmethod() {
        b.method();
    }
}

// ν΄λΌμ΄μ–ΈνΈ μ½”λ“ : κµ¬ν„μ²΄λ¥Ό μ£Όμ…λ°›μ•„μ•Ό κ°μ²΄κ°€ μƒμ„±λλ‹¤.
new A(new BImpl1());
```

μƒμ„±μ μ£Όμ…μ κ²½μ°, `AImpl(B b)`μ²λΌ λ°λ“μ‹ Aκ°€ B κ°μ²΄λ¥Ό μ£Όμ…λ°›μ•„μ•Ό μƒμ„±λλ‹¤.



### μƒμ„±μ μ£Όμ…μ„ μ‚¬μ©ν•΄μ•Ό ν•λ” μ΄μ 

μƒμ„±μλ¥Ό ν†µν•΄μ„ κµ¬ν„μ²΄λ¥Ό μ£Όμ…λ°›μ„ κ²½μ°, λ°λ“μ‹ κµ¬ν„μ²΄(`BIml1`)λ¥Ό μ£Όμ…λ°›μ•„μ•Ό κ°μ²΄ Aκ°€ μƒμ„±λλ‹¤. λ”°λΌμ„ <mark style="background-color:yellow;">κ°μ²΄ Aλ” κ°μ²΄ Bκ°€ ν•­μƒ μλ‹¤. ν•„λ“ μ£Όμ…μ΄λ‚ μμ •μ μ£Όμ…μ²λΌ B κ°μ²΄κ°€ μ—†μ–΄</mark> <mark style="background-color:yellow;"></mark><mark style="background-color:yellow;">`bmethod()`</mark> <mark style="background-color:yellow;"></mark><mark style="background-color:yellow;">μ‹¤ν–‰μ‹ NPEκ°€ λ°μƒν•λ” μΌμ΄ μ—†λ‹¤</mark>. λν• Aμ™€ Bμ μμ΅΄κ΄€κ³„λ¥Ό ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— λ…Έμ¶μ‹μΌ <mark style="background-color:yellow;">μ»΄νμΌ νƒ€μ„μ— μ—λ¬</mark>λ¥Ό μ΅μ„ μ μλ‹¤.





**Reference**

*   μƒμ„±μ μ£Όμ…μ„ ν•΄μ•Όν•λ” μ΄μ 

    [https://yaboong.github.io/spring/2019/08/29/why-field-injection-is-bad/](https://yaboong.github.io/spring/2019/08/29/why-field-injection-is-bad/)





